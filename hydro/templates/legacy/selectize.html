<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hydro Chart</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body>
  <h1>Hydro Chart</h1>
  <label for="year-select">Select Year:</label>
  <select id="year-select">
    <!-- Year options will be populated dynamically -->
  </select>
  <canvas id="hydro-chart" width="800" height="400"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var yearSelect = document.getElementById('year-select');
      var chartCanvas = document.getElementById('hydro-chart').getContext('2d');
      var stationId = 'ptaci';
      var chart;

      // Populate year select options
      fetch(`/api/stations/${stationId}/years/`) // Replace <station_id> with actual station ID
        .then(response => response.json())
        .then(data => {
          data.forEach(year => {
            var option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Failed to load years:', error))
        .finally(() => {
          // Render chart after fetching years
          renderChart();
        });

      // Render chart on year change
      function renderChart() {
        yearSelect.addEventListener("change", function() {
          var selectedYear = this.value;
          var field = 'wl_mm'; // Replace 'wl_mm' with actual field name
          fetch(`/api/stations/${stationId}/data/?year=${selectedYear}&field=${field}`) // Replace <station_id> with actual station ID
            .then(response => response.json())
            .then(data => {
              if (chart) {
                chart.destroy(); // Destroy previous chart instance
              }
              chart = new Chart(chartCanvas, {
                type: 'line',
                data: {
                  labels: data.map(entry => entry.date),
                  datasets: [{
                    label: 'Value',
                    data: data.map(entry => entry.value),
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                  }]
                },
                options: {
                  scales: {
                    x: {
                      type: 'time',
                      time: {
                        unit: 'month'
                      }
                    },
                    y: {
                      title: {
                        display: true,
                        text: 'Value'
                      }
                    }
                  }
                }
              });
            })
            .catch(error => console.error('Failed to load chart data:', error));
        });
      }
    });
  </script>
</body>
</html>
