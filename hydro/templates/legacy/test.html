<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="chart"></div>

<script>
    // Main hourly data for a whole year
    var hourlyData = [
        {"date": "2018-01-01T00:00:00", "value": 104.0},
        {"date": "2018-01-01T01:00:00", "value": 105.0},
        // Add more hourly data for the entire year
        {"date": "2018-12-31T23:00:00", "value": 102.0}
    ];

    // Monthly percentile data
    var monthlyData = [
        {"month": "01", "q10": 62.83, "q20": 79.5, "q30": 93.5, "q40": 102.0, "q50": 109.83, "q60": 116.0, "q70": 125.0, "q80": 140.27, "q90": 173.17},
        {"month": "02", "q10": 0.0, "q20": 72.83, "q30": 91.33, "q40": 117.70, "q50": 139.67, "q60": 155.0, "q70": 170.10, "q80": 192.17, "q90": 354.07},
        // Add data for all months
        {"month": "12", "q10": 50.0, "q20": 70.0, "q30": 90.0, "q40": 110.0, "q50": 130.0, "q60": 150.0, "q70": 170.0, "q80": 190.0, "q90": 210.0}
    ];

    // Extract data for hourly trace
    var hourlyDates = hourlyData.map(d => d.date);
    var hourlyValues = hourlyData.map(d => d.value);

    // Prepare monthly percentile traces
    var currentYear = new Date(hourlyDates[0]).getFullYear();
    var firstDayOfMonths = monthlyData.map(d => `${currentYear}-${d.month}-01T00:00:00`);
    var q10 = monthlyData.map(d => d.q10);
    var q20 = monthlyData.map(d => d.q20);
    var q30 = monthlyData.map(d => d.q30);
    var q40 = monthlyData.map(d => d.q40);
    var q50 = monthlyData.map(d => d.q50);
    var q60 = monthlyData.map(d => d.q60);
    var q70 = monthlyData.map(d => d.q70);
    var q80 = monthlyData.map(d => d.q80);
    var q90 = monthlyData.map(d => d.q90);

    // Create traces
    var hourlyTrace = {
        x: hourlyDates,
        y: hourlyValues,
        mode: 'lines',
        name: 'Hourly Values'
    };

    var percentileTraces = [
        { x: firstDayOfMonths, y: q10, mode: 'lines+markers', name: '10th Percentile' },
        { x: firstDayOfMonths, y: q20, mode: 'lines+markers', name: '20th Percentile' },
        { x: firstDayOfMonths, y: q30, mode: 'lines+markers', name: '30th Percentile' },
        { x: firstDayOfMonths, y: q40, mode: 'lines+markers', name: '40th Percentile' },
        { x: firstDayOfMonths, y: q50, mode: 'lines+markers', name: '50th Percentile' },
        { x: firstDayOfMonths, y: q60, mode: 'lines+markers', name: '60th Percentile' },
        { x: firstDayOfMonths, y: q70, mode: 'lines+markers', name: '70th Percentile' },
        { x: firstDayOfMonths, y: q80, mode: 'lines+markers', name: '80th Percentile' },
        { x: firstDayOfMonths, y: q90, mode: 'lines+markers', name: '90th Percentile' }
    ];

    // Combine all traces
    var allTraces = [hourlyTrace].concat(percentileTraces);

    // Define layout
    var layout = {
        title: 'Hourly Data and Monthly Percentiles',
        xaxis: {
            title: 'Date',
            type: 'date',
            range: [`${currentYear}-01-01`, `${currentYear}-12-31`],
            tickformat: '%Y-%m-%d'
        },
        yaxis: {
            title: 'Value'
        }
    };

    // Plot the chart
    Plotly.newPlot('chart', allTraces, layout);
</script>

</body>
</html>


const lowerFill = {
    x: months,
    y: q10,
    fill: 'tonexty',  // fill to next trace (q20)
    type: 'scatter',
    mode: 'none',
    name: 'q10 to q20',
    line: { color: 'rgba(0,0,0,0)' }
};

const middleFill = {
    x: months,
    y: q20,
    fill: 'tonexty',  // fill to next trace (q80)
    type: 'scatter',
    mode: 'none',
    name: 'q20 to q80',
    line: { color: 'rgba(0,0,0,0)' }
};

const upperFill = {
    x: months,
    y: q80,
    fill: 'tonexty',  // fill to next trace (q90)
    type: 'scatter',
    mode: 'none',
    name: 'q80 to q90',
    line: { color: 'rgba(0,0,0,0)' }
};

const medianTrace = {
    x: months,
    y: q50,
    mode: 'lines',
    type: 'scatter',
    name: 'Median',
    line: { color: 'blue' }
};

const dataWithPercentiles = [trace, lowerFill, middleFill, upperFill, medianTrace];
Plotly.newPlot(chartDiv, dataWithPercentiles, layout); //might need revision calling new plot twice?



else if (currentChartType === 'box') {
    trace = {
        y: values,
        type: 'box'
    };
}

const layout = {
    title: `${valueField} in ${year}`,
    xaxis: {
        title: currentChartType === 'line' ? 'Date' : 'Value'
    },
    yaxis: {
        title: 'Value'
    }
};

Plotly.newPlot(chartDiv, [trace], layout);